version: 1

# Amplify build spec for React + Vite + TypeScript app located in ./frontend
# - Vite build outputs to frontend/dist
# - SPA routing handled by frontend/public/_redirects (deployed with build)
# - Environment variables (VITE_*) should be managed in Amplify Console per environment

frontend:
  phases:
    preBuild:
      commands:
        - echo "[PreBuild] Installing dependencies"
        - cd frontend
        - npm ci || npm install
    build:
      commands:
        - echo "[Build] Running Vite build"
        - npm run build
        - echo "[Build] Build complete"
  artifacts:
    baseDirectory: frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*

# Optional test phase template:
# test:
#   phases:
#     preTest:
#       commands: []
#     test:
#       commands:
#         - npm run test -- --watch=false

# Notes:
# 1. Ensure this file is at repository root for Amplify detection.
# 2. Add environment variables in Amplify Console: VITE_API_BASE_URL, VITE_COGNITO_REGION,
#    VITE_COGNITO_USER_POOL_ID, VITE_COGNITO_CLIENT_ID, VITE_COGNITO_DOMAIN,
#    VITE_REDIRECT_URI, VITE_LOGOUT_URI, VITE_OAUTH_SCOPES.
# 3. After first deploy, verify Hosted UI redirect works (Cognito callback matches Amplify domain + /callback).
