version: 1

# Amplify build spec for React + Vite + TypeScript app located in webApp/frontend
# - Vite build outputs to webApp/frontend/dist
# - Environment variables (VITE_*) are set in Amplify Console (App settings > Environment variables)
# - Lambda Function URL + Cognito details should be provided as VITE_* vars

frontend:
  phases:
    preBuild:
      commands:
        - echo "[PreBuild] Installing dependencies"
        - cd webApp/frontend
        - npm ci || npm install
    build:
      commands:
        - echo "[Build] Running Vite build"
        - npm run build
        - echo "[Build] Build complete"
  artifacts:
    baseDirectory: webApp/frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - webApp/frontend/node_modules/**/*

env:
  variables:
    # Placeholder (real values must be set via Amplify Console UI):
    VITE_OAUTH_SCOPES: "openid profile email read.inventory reserve.stock"

# Optional test phase template:
# test:
#   phases:
#     preTest:
#       commands: []
#     test:
#       commands:
#         - npm run test -- --watch=false

# Notes:
# 1. Ensure this file is at repository root for Amplify detection.
# 2. Add environment variables: VITE_API_BASE_URL, VITE_COGNITO_REGION, VITE_COGNITO_USER_POOL_ID,
#    VITE_COGNITO_CLIENT_ID, VITE_COGNITO_DOMAIN, VITE_REDIRECT_URI, VITE_LOGOUT_URI.
# 3. After first deploy, verify Hosted UI redirect works (Cognito callback matches Amplify domain + /callback).
